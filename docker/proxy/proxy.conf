# Configuration du proxy Apache pour rediriger vers l'API backend
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

<VirtualHost *:80>
    ServerName localhost
    
    # Activation des logs
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
    
    # Redirection de l'API
    ProxyPass /api http://backend-api:8080
    ProxyPassReverse /api http://backend-api:8080
    
    # Redirection directe à la racine vers l'API (optionnel)
    ProxyPass / http://backend-api:8080/
    ProxyPassReverse / http://backend-api:8080/
    
    # Redirection des endpoints actuator pour le monitoring
    ProxyPass /actuator http://backend-api:8080/actuator
    ProxyPassReverse /actuator http://backend-api:8080/actuator
    
    # En-têtes pour le proxy
    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    
    # Configuration de base pour la page d'accueil (utilisé si pas de ProxyPass à la racine)
    DocumentRoot /usr/local/apache2/htdocs/
    
    <Directory "/usr/local/apache2/htdocs/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
</VirtualHost>
